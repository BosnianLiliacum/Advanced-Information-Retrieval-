Post Title: Failed to set up wireguard
Author: VivaPitagoras
Score: 2
URL: https://www.reddit.com/r/selfhosted/comments/1eaz191/failed_to_set_up_wireguard/
Number of comments: 5
Created UTC: 2024-07-24 11:24:59

Post Content:
So, I've used wg-easy to set up wireguard using docker (I've also forwarded wg port in my router). However it appears I can connect to my LAN from internet nor have internet access when VPN is active on my phone.

This is my docker compose:

volumes:
  etc_wireguard:

services:
  wg-easy:
    environment:
      # Change Language:
      # (Supports: en, ua, ru, tr, no, pl, fr, de, ca, es, ko, vi, nl, is, pt, chs, cht, it, th, hi)
      - LANG=en
      # ⚠️ Required:
      # Change this to your host's public address
      - WG_HOST=publicIP

      # Optional:
      - PASSWORD=foobar123
      # - PASSWORD_HASH=$$2y$$10$$hBCoykrB95WSzuV4fafBzOHWKu9sbyVa34GJr8VV5R/pIelfEMYyG (needs double $$, hash of 'foobar123'; see "How_to_generate_an_bcrypt_hash.md" for generate the hash)
      # - PORT=51821
      # - WG_PORT=51820
      # - WG_CONFIG_PORT=92820
      # - WG_DEFAULT_ADDRESS=10.8.0.x
      # - WG_DEFAULT_DNS=1.1.1.1
      # - WG_MTU=1420
      # - WG_ALLOWED_IPS=192.168.15.0/24, 10.0.1.0/24
      # - WG_PERSISTENT_KEEPALIVE=25
      # - WG_PRE_UP=echo "Pre Up" &gt; /etc/wireguard/pre-up.txt
      # - WG_POST_UP=echo "Post Up" &gt; /etc/wireguard/post-up.txt
      # - WG_PRE_DOWN=echo "Pre Down" &gt; /etc/wireguard/pre-down.txt
      # - WG_POST_DOWN=echo "Post Down" &gt; /etc/wireguard/post-down.txt
      - UI_TRAFFIC_STATS=true
      - UI_CHART_TYPE=1 # (0 Charts disabled, 1 # Line chart, 2 # Area chart, 3 # Bar chart)

    image: ghcr.io/wg-easy/wg-easy
    container_name: wg-easy
    volumes:
      - etc_wireguard:/etc/wireguard
    ports:
      - "51820:51820/udp"
      - "51821:51821/tcp"
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
      # - NET_RAW # ⚠️ Uncomment if using Podman 
    sysctls:
      - net.ipv4.ip_forward=1
      - net.ipv4.conf.all.src_valid_mark=1


Sorry for the mess. I am on my phone and it does what it wants.

Top 3 comments:
Comment 1:
  Author: HereComesBS
  Comment: It's early so I could be missing something else, but I think you need to set a few more options.

The only standouts that are different from my setup is you're not setting the WG_DEFAULT_DNS and WG_HOST. WG_HOST is required and although optional not setting WG_DEFAULT_DNS may cause other issues.

*WG_DEFAULT_DNS:   DNS server clients will use. If set to blank value, clients will not use any DNS.*

https://github.com/wg-easy/wg-easy
  Score: 2
  Created UTC: 2024-07-24 11:40:26

Comment 2:
  Author: Background-Piano-665
  Comment: Sorry, but I can't understand the config file...

First of all though, what do the logs on the client side say? Is there a handshake? And can you ping the server using IP?
  Score: 2
  Created UTC: 2024-07-24 11:43:45

Comment 3:
  Author: Shadowedcreations
  Comment: I have been meaning to ask this... Sometimes with new setups I have this issue sometimes it just works. The one I hate more is when the mobile qr clients work but the ones I have to manually setup can't get internet.
  Score: 1
  Created UTC: 2024-07-24 13:09:38

Note: This post has only 3 comments at the time of scraping.
